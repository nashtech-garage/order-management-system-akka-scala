name: Integration CI

on:
  push:
    branches: [ main, feature/github-action-ci ]
  pull_request:
    branches: [ main, feature/github-action-ci ]
  workflow_run:
    workflows:
      - "API Gateway CI"
      - "Customer Service CI"
      - "Order Service CI"
      - "Payment Service CI"
      - "Product Service CI"
      - "Report Service CI"
      - "User Service CI"
      - "Frontend CI"
    types:
      - completed

jobs:
  integration-check:
    name: Integration Check
    runs-on: ubuntu-latest
    if: github.event_name == 'push' || github.event_name == 'pull_request'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verify docker-compose configuration
        env:
          POSTGRES_HOST: localhost
          POSTGRES_EXPOSE_PORT: 5433
          POSTGRES_PORT: 5432
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: postgres
        run: docker compose config

      - name: Check configuration files
        run: |
          echo "✅ Checking project configuration..."
          test -f backend/build.sbt && echo "✅ Backend build.sbt exists"
          test -f frontend/package.json && echo "✅ Frontend package.json exists"
          test -f docker-compose.yml && echo "✅ Docker Compose file exists"

      - name: All checks passed
        run: echo "✅ All integration checks passed successfully!"
